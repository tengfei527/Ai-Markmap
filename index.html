<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>AI思维导图生成 - AiMarkmap</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23667eea'/%3E%3Cg stroke='white' stroke-width='6' stroke-linecap='round'%3E%3Cline x1='50' y1='50' x2='80' y2='25'/%3E%3Cline x1='50' y1='50' x2='25' y2='40'/%3E%3Cline x1='50' y1='50' x2='60' y2='80'/%3E%3C/g%3E%3Ccircle cx='50' cy='50' r='12' fill='white'/%3E%3Ccircle cx='80' cy='25' r='8' fill='white'/%3E%3Ccircle cx='25' cy='40' r='8' fill='white'/%3E%3Ccircle cx='60' cy='80' r='8' fill='white'/%3E%3Cpath d='M50 44L52 48 L56 50 L52 52 L50 56 L48 52 L44 50 L48 48 Z' fill='%23764ba2'/%3E%3C/svg%3E">
    <script src="https://unpkg.com/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://unpkg.com/markmap-lib@0.15.3/dist/browser/index.js"></script>
    <script src="https://unpkg.com/markmap-view@0.15.3/dist/browser/index.js"></script>
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="src/css/design-tokens.css">
    <link rel="stylesheet" href="src/css/components.css">
    <link rel="stylesheet" href="src/css/responsive.css">
    <link rel="stylesheet" href="src/css/toast.css">
</head>
<body>
    <div class="header">
        <h1>AiMarkmap <span class="ai-badge">AI Powered</span></h1>
        <div class="header-right">
            <button id="info-btn" class="github-link" style="background:none; border:none; cursor:pointer; padding:0; color:white;" data-t-title="helpBtnTitle">
                <svg class="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
                    <path d="M0 0h24v24H0z" fill="none"></path>
                    <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"></path>
                </svg>
            </button>
            <a href="https://github.com/tengfei527/Ai-Markmap" title="View on GitHub" target="_blank" rel="noopener noreferrer" class="github-link">
                <svg class="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></svg>
            </a>
            <div class="theme-selector">
                <select id="theme-select" class="theme-select">
                    <option value="default">默认主题</option>
                    <option value="dark">深色主题</option>
                    <option value="blue">蓝色主题</option>
                    <option value="green">绿色主题</option>
                    <option value="purple">紫色主题</option>
                </select>
            </div>
            <button id="mode-toggle" class="mode-toggle-btn" title="切换日/夜模式">
                <svg class="mode-icon sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-12a.75.75 0 0 0 .75-.75V3a.75.75 0 0 0-1.5 0v1.25A.75.75 0 0 0 12 5zm0 16a.75.75 0 0 0 .75-.75V21a.75.75 0 0 0-1.5 0v-1.25A.75.75 0 0 0 12 21zM4.22 6.22a.75.75 0 0 0 1.06 0l.97-.97a.75.75 0 0 0-1.06-1.06l-.97.97a.75.75 0 0 0 0 1.06zm14.5 14.5a.75.75 0 0 0 1.06 0l.97-.97a.75.75 0 1 0-1.06-1.06l-.97.97a.75.75 0 0 0 0 1.06zM3 12a.75.75 0 0 0-.75-.75H1a.75.75 0 0 0 0 1.5h1.25A.75.75 0 0 0 3 12zm20 0a.75.75 0 0 0-.75-.75H21a.75.75 0 0 0 0 1.5h1.25A.75.75 0 0 0 23 12zM6.22 19.78a.75.75 0 0 0 0-1.06l-.97-.97a.75.75 0 0 0-1.06 1.06l.97.97a.75.75 0 0 0 1.06 0zm14.5-14.5a.75.75 0 0 0 0-1.06l-.97-.97a.75.75 0 1 0-1.06 1.06l.97.97a.75.75 0 0 0 1.06 0z"/>
                </svg>
                <svg class="mode-icon moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" >
                    <path d="M21.752 15.002A9.718 9.718 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998z"/>
                </svg>
            </button>
            <div id="lang-switcher">
                <button data-lang="zh" class="lang-btn">中文</button>
                <button data-lang="en" class="lang-btn">EN</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="editor-panel">
            <div class="panel-header">
                <button class="fold-btn" id="fold-btn" title="折叠/展开面板">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <button class="control-btn" id="prompt-settings-btn" data-t="promptSettingsBtn"></button>
                <button class="control-btn" id="settings-btn" onclick="openSettingsModal()" data-t="apiSettingsBtn"></button>
            </div>
            <div class="panel-section">
                 <div class="config-row">
                    <span class="config-label" data-t="modelLabel"></span>
                    <div class="model-input-wrapper">
                        <div class="model-container">
                            <select id="model-select" class="model-select">
                                <option value="custom">自定义</option>
                                <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
                            </select>
                            <button class="query-models-btn" id="query-models-btn" onclick="queryAvailableModels()" data-t="queryBtn"></button>
                        </div>
                        <input type="text" id="custom-model-input" class="config-input hidden" data-t-placeholder="customModelInputPlaceholder">
                    </div>
                </div>
            </div>
            <div class="panel-section">
                <div class="config-row">
                    <span class="config-label" data-t="versionsLabel"></span>
                    <input type="range" id="version-slider" min="1" max="5" value="3">
                    <span id="version-count-display">3</span>
                </div>
            </div>
            <div class="panel-section">
                <div class="button-row">
                    <button class="control-btn ai-btn" id="generate-btn" onclick="generateWithAI()" data-t="generateBtn"></button>
                    <button class="control-btn ai-btn" id="paste-generate-btn" onclick="pasteAndGenerate()" data-t="pasteGenerateBtn"></button>
                </div>
                <div class="button-row">
                    <button class="control-btn view-btn" id="show-original-btn" onclick="switchView('original')" data-t="showOriginalBtn"></button>
                    <button class="control-btn markdown-btn" id="show-markdown-btn" onclick="switchView('markdown')" data-t="showMarkdownBtn"></button>
                    <button class="control-btn clear-btn" id="clear-btn" onclick="clearContent()" data-t="clearBtn"></button>
                </div>
            </div>
            <div class="input-section">
                <textarea id="topic-input" class="text-input" data-t-placeholder="topicInputPlaceholder"></textarea>
                <textarea id="content-display" class="content-display" style="display: none;" data-t-placeholder="contentDisplayPlaceholder"></textarea>
            </div>
        </div>
        
        <div class="mindmap-panel">
            <div class="mindmap-header">
                <div class="panel-title" data-t="mindmapPreviewTitle"></div>
                <div id="results-tabs" class="results-tabs"></div>
                <div class="export-buttons">
                    <button id="fullscreen-btn" class="export-btn" onclick="toggleFullScreen()"></button>
                    <button id="export-svg-btn" class="export-btn" onclick="exportSVG()" data-t="exportSvgBtn" disabled></button>
                    <button id="export-png-btn" class="export-btn" onclick="exportPNG()" data-t="exportPngBtn" disabled></button>
                </div>
            </div>
            <div class="mindmap-container" id="mindmap-container">
                <svg id="mindmap"></svg>
                <div id="loading-overlay" class="loading-overlay" style="display: none;">
                    <div class="spinner-container">
                        <div class="loading-spinner"></div>
                        <span id="timer-display"></span>
                    </div>
                    <div data-t="thinkingMessage"></div>
                    <div class="status-message" id="status-message"></div>
                    <div class="status-message" id="status-message"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Dialogs -->
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeSettingsModal()">&times;</button>
            <div class="panel-header">
                <div class="panel-title" data-t="apiSettingsTitle"></div>
            </div>
            <div class="ai-config">
                <div class="config-row">
                    <span class="config-label" data-t="apiUrlLabel"></span>
                    <input type="text" id="api-url" class="config-input" data-t-placeholder="apiUrlPlaceholder" />
                </div>
                <div class="config-row">
                    <span class="config-label" data-t="apiKeyLabel"></span>
                    <div class="password-input-wrapper">
                        <input type="password" id="api-key" class="config-input" data-t-placeholder="apiKeyPlaceholder" />
                        <button type="button" id="toggle-api-key-visibility" class="visibility-toggle-btn" data-t-title="toggleVisibilityTitle">👁️</button>
                    </div>
                </div>
                <div class="button-row">
                    <button class="control-btn ai-btn" onclick="saveAndCloseSettings()" data-t="saveAndCloseBtn"></button>
                </div>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closePromptModal()">&times;</button>
            <div class="panel-header">
                <div class="panel-title" data-t="promptSettingsTitle"></div>
            </div>
            <div class="ai-config">
                <div class="prompt-tip" data-t="promptTip"></div>
                <textarea id="prompt-input" class="text-input" style="height: 350px; min-height: 200px; margin-bottom: 1rem;" data-t-placeholder="promptInputPlaceholder"></textarea>
                <div class="button-row">
                    <button class="control-btn ai-btn" onclick="saveAndClosePrompt()" data-t="saveAndCloseBtn"></button>
                </div>
            </div>
        </div>
    </div>

    <div id="edit-node-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeEditModal()">&times;</button>
            <div class="panel-header">
                <div class="panel-title" data-t="editNodeTitle"></div>
            </div>
            <div class="ai-config">
                <textarea id="edit-node-input" class="text-input" data-t-placeholder="editNodePlaceholder"></textarea>
                <div class="button-row">
                    <button class="control-btn ai-btn" onclick="saveNodeEdit()" data-t="saveAndCloseBtn"></button>
                </div>
            </div>
        </div>
    </div>

    <div id="info-modal" class="modal-overlay hidden">
        <div class="modal-content" style="width: 800px; max-height: 80vh; display: flex; flex-direction: column;">
            <button class="modal-close-btn" onclick="closeInfoModal()">&times;</button>
            <div class="panel-header">
                <div class="panel-title" data-t="infoModalTitle"></div>
            </div>
            <div class="info-modal-content" style="overflow-y: auto; flex-grow: 1;">
                
            </div>
        </div>
    </div>

    <script src="src/js/translations.js"></script>
    <script src="src/js/utils.js"></script>
    <script src="src/js/error-handler.js"></script>
    <script src="src/js/config.js"></script>
    <script src="src/js/ui.js"></script>
    <script src="src/js/ai.js"></script>
    <script src="src/js/export.js"></script>
    <script src="src/js/editor.js"></script>
    <script src="src/js/main.js"></script>
</body>
</html>